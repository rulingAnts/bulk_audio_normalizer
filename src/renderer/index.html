<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; script-src 'self'; media-src 'self' file: data:;" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bulk Audio Normalizer (-16 LUFS, 16-bit WAV)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>Bulk Audio Normalizer</h1>
      <p>Converts to 16-bit WAV and normalizes to -16 LUFS with a hard limiter (no clipping).</p>
    </header>

    <section class="controls">
      <div class="picker">
        <label>Input folder</label>
        <div class="row">
          <input id="inputPath" type="text" placeholder="Choose input folder" readonly />
          <button id="btnInput">Browse…</button>
        </div>
      </div>
      <div class="picker">
        <label>Output folder (must be empty)</label>
        <div class="row">
          <input id="outputPath" type="text" placeholder="Choose empty output folder" readonly />
          <button id="btnOutput">Browse…</button>
        </div>
        <div id="outputValidation" class="hint"></div>
      </div>
      <div class="actions">
        <button id="btnStart" disabled>Start</button>
        <button id="btnCancel" disabled>Cancel</button>
      </div>
    </section>

    <section class="overall">
      <div class="row label-row">
        <span>Overall progress</span>
        <span id="overallCount">0/0</span>
        <span id="overallPct">0%</span>
      </div>
      <div class="progress"><div id="overallBar" class="bar" style="width:0%"></div></div>
    </section>

    <section class="preview">
      <h2>Preview (random spot check)</h2>
      <div class="row">
        <label for="previewCount" class="inline-label">Sample size</label>
        <input id="previewCount" type="number" min="1" max="50" value="5" />
        <button id="btnPreview">Run Preview</button>
      </div>
      <div id="previewInfo" class="hint"></div>
      <div id="previewList" class="preview-list"></div>
    </section>

    <details id="advSettings" class="settings">
      <summary>Advanced…</summary>
      <div class="grid">
        <label for="lufsTarget">LUFS target</label>
        <input id="lufsTarget" type="number" step="0.1" value="-16" />

        <label for="tpMargin">True-peak target (dBFS)</label>
        <input id="tpMargin" type="number" step="0.1" value="-1" />

        <label for="limiterLimit">Limiter ceiling (linear 0..1)</label>
        <input id="limiterLimit" type="number" step="0.01" min="0" max="1" value="0.97" />

        <label for="concurrency">Concurrency</label>
        <input id="concurrency" type="number" min="1" max="16" value="4" />
        
        <div class="sep" style="grid-column: 1 / -1; height: 8px;"></div>

        <label for="autoTrim">Auto-trim leading/trailing silence</label>
        <input id="autoTrim" type="checkbox" checked />

        <label for="trimPadMs">Keep padding each side (ms)</label>
        <input id="trimPadMs" type="number" min="0" value="500" />

        <label for="trimThresholdDb">Silence threshold (dBFS)</label>
        <input id="trimThresholdDb" type="number" step="1" value="-50" />

        <label for="trimMinDurationMs">Minimum silence duration (ms)</label>
        <input id="trimMinDurationMs" type="number" min="0" value="200" />

        <label for="trimMinFileMs">Only trim if file longer than (ms)</label>
        <input id="trimMinFileMs" type="number" min="0" value="800" />

        <label for="trimConservative">Conservative trim (safer for soft voices)</label>
        <input id="trimConservative" type="checkbox" checked />

        <label for="trimHPF">Pre-filter rumble (HPF 80 Hz)</label>
        <input id="trimHPF" type="checkbox" />

        <div class="sep" style="grid-column: 1 / -1; height: 8px;"></div>

        <label for="verboseLogs">Verbose FFmpeg logs</label>
        <input id="verboseLogs" type="checkbox" />
      </div>
      <div class="hint">Tip: Lower limiter ceiling (e.g., 0.97) for extra headroom. TP is in dBFS (negative values).</div>
    </details>

    <section class="files">
      <h2>Files</h2>
      <div id="fileList" class="file-list"></div>
    </section>

    <section class="logs">
      <h2>Log</h2>
      <div class="log-actions">
        <button id="btnClearLog">Clear log</button>
      </div>
      <pre id="logView" class="log-view"></pre>
    </section>

    <footer>
      <small>Tip: Hundreds of short WAVs are fine. The app won’t modify originals; it writes new files to the output folder.</small>
    </footer>

    <!-- WaveSurfer UMD from local node_modules -->
    <script src="../../node_modules/wavesurfer.js/dist/wavesurfer.min.js"></script>
    <script src="../../node_modules/wavesurfer.js/dist/plugin/wavesurfer.regions.min.js"></script>
    <script src="renderer.js"></script>
  </body>
</html>
